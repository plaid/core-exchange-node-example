<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quick API Test - Dev Client</title>
  <link href="/public/styles.css" rel="stylesheet">
  <style>
    .json-response {
      font-family: 'Inconsolata', Monaco, Menlo, 'Courier New', monospace;
      white-space: pre-wrap;
      background: var(--plaid-black);
      color: var(--plaid-white);
      border-radius: 8px;
      padding: 1rem;
      overflow-x: auto;
      max-height: 400px;
      overflow-y: auto;
    }
  </style>
</head>
<body class="bg-plaid-light-gray min-h-screen">
  <%- include('partials/navigation', { tokens, currentPage: 'accounts' }) %>

  <div class="max-w-4xl mx-auto px-4 py-8">
    <div class="mb-8">
      <h1 class="text-3xl font-bold text-plaid-black">Quick API Test</h1>
      <p class="text-plaid-dark-gray mt-2">Simple test of the accounts endpoint</p>
    </div>

    <!-- API Call Info -->
    <div class="bg-white rounded-lg shadow-sm border border-plaid-blue-sky-200 p-6 mb-8">
      <h2 class="text-lg font-semibold text-plaid-black mb-4">API Call Details</h2>

      <div class="bg-plaid-light-gray rounded-md p-4">
        <div class="flex items-center justify-between mb-2">
          <span class="px-2 py-1 bg-plaid-credit-lime-200 text-plaid-credit-lime-700 text-xs font-medium rounded">GET</span>
          <span class="text-sm font-mono text-plaid-dark-gray">/api/fdx/v6/accounts?limit=3</span>
        </div>
        <div class="text-xs text-plaid-gray">
          This endpoint returns the first 3 accounts for the authenticated user
        </div>
      </div>
    </div>

    <!-- Response Section -->
    <div class="bg-white rounded-lg shadow-sm border border-plaid-blue-sky-200 p-6">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-lg font-semibold text-plaid-black">API Response</h2>
        <a href="/api-explorer"
           class="inline-flex items-center px-3 py-2 bg-plaid-mint-600 border border-transparent rounded-md text-sm font-medium text-white hover:bg-plaid-mint-700 transition-colors">
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path>
          </svg>
          Try More Endpoints
        </a>
      </div>
      
      <% if (typeof error !== 'undefined' && error) { %>
        <!-- Error State -->
        <div class="bg-plaid-piggy-bank-200 border border-plaid-piggy-bank-200 rounded-md p-4">
          <div class="flex">
            <div class="flex-shrink-0">
              <svg class="h-5 w-5 text-plaid-piggy-bank-600" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
              </svg>
            </div>
            <div class="ml-3">
              <h3 class="text-sm font-medium text-plaid-piggy-bank-700">API Call Failed</h3>
              <div class="mt-2 text-sm text-plaid-piggy-bank-700">
                <div class="json-response bg-plaid-piggy-bank-700 text-plaid-piggy-bank-200"><%= JSON.stringify(error, null, 2) %></div>
              </div>
            </div>
          </div>
        </div>
      <% } else if (apiResponse) { %>
        <!-- Success State -->
        <div class="space-y-4">
          <div class="flex items-center text-sm text-plaid-credit-lime-600">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
            </svg>
            API call completed successfully
          </div>

          <!-- Formatted JSON Response -->
          <div class="json-response"><%= JSON.stringify(apiResponse, null, 2) %></div>

          <!-- Summary -->
          <% if (apiResponse.accounts && apiResponse.accounts.length > 0) { %>
            <div class="bg-plaid-mint-200 border border-plaid-mint-200 rounded-md p-4">
              <h3 class="text-sm font-medium text-plaid-mint-700 mb-2">Response Summary</h3>
              <ul class="text-sm text-plaid-mint-700 space-y-1">
                <li>• Found <%= apiResponse.accounts.length %> account(s)</li>
                <% if (apiResponse.page && apiResponse.page.nextOffset) { %>
                  <li>• More accounts available (next offset: <%= apiResponse.page.nextOffset %>)</li>
                <% } else { %>
                  <li>• No more accounts available</li>
                <% } %>
                <li>• Account types: <%= apiResponse.accounts.map(acc => acc.accountType).join(', ') %></li>
              </ul>
            </div>
          <% } %>
        </div>
      <% } else { %>
        <!-- Loading/Default State -->
        <div class="text-center py-8">
          <svg class="w-12 h-12 text-plaid-gray mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          <p class="text-plaid-gray">Loading API response...</p>
        </div>
      <% } %>
    </div>

    <!-- Action Buttons -->
    <div class="mt-8 flex justify-center space-x-4">
      <button onclick="window.location.reload()"
              class="inline-flex items-center px-4 py-2 border border-plaid-blue-sky-200 rounded-md shadow-sm text-sm font-medium text-plaid-dark-gray bg-white hover:bg-plaid-light-gray transition-colors">
        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
        </svg>
        Refresh
      </button>

      <a href="/api-explorer"
         class="inline-flex items-center px-4 py-2 bg-plaid-mint-600 border border-transparent rounded-md shadow-sm text-sm font-medium text-white hover:bg-plaid-mint-700 transition-colors">
        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
        </svg>
        Explore More APIs
      </a>
    </div>
  </div>
</body>
</html>